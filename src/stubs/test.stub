<?php

namespace Tests\Feature;

use Illuminate\Foundation\Testing\RefreshDatabase;
use Illuminate\Foundation\Testing\WithFaker;
use Tests\TestCase;
use App\Models\{{class}};

class {{class}}Test extends TestCase
{
    use RefreshDatabase, WithFaker;

    protected string $baseUrl = '/api/{{routePath}}';

    public function test_can_get_paginated_{{modelVariablePlural}}(): void
    {
        {{class}}::factory()->count(25)->create();

        $response = $this->getJson($this->baseUrl);

        $response->assertStatus(200)
                 ->assertJsonStructure([
                     'data',
                     'current_page',
                     'per_page',
                     'total',
                     'last_page',
                 ])
                 ->assertJsonCount({{perPage}}, 'data');
    }

    public function test_can_get_custom_per_page_{{modelVariablePlural}}(): void
    {
        {{class}}::factory()->count(30)->create();

        $response = $this->getJson($this->baseUrl . '?per_page=10');

        $response->assertStatus(200)
                 ->assertJsonCount(10, 'data')
                 ->assertJson([
                     'per_page' => 10,
                 ]);
    }

    public function test_can_navigate_pagination_pages(): void
    {
        {{class}}::factory()->count(25)->create();

        $response = $this->getJson($this->baseUrl . '?page=2');

        $response->assertStatus(200)
                 ->assertJson([
                     'current_page' => 2,
                 ]);
    }

    public function test_can_create_{{modelVariable}}(): void
    {
        $data = [
            // Add your test data here
            // 'name' => $this->faker->name,
            // 'email' => $this->faker->unique()->safeEmail,
        ];

        $response = $this->postJson($this->baseUrl, $data);

        $response->assertStatus(201)
                 ->assertJsonStructure([
                     'message',
                     'data',
                 ]);
        // $this->assertDatabaseHas('{{tableName}}', $data);
    }

    public function test_validation_error_on_create_{{modelVariable}}(): void
    {
        $data = [
            // Add invalid data here
        ];

        $response = $this->postJson($this->baseUrl, $data);

        $response->assertStatus(422)
                 ->assertJsonValidationErrors([
                     // 'name',
                     // 'email',
                 ]);
    }

    public function test_can_get_single_{{modelVariable}}(): void
    {
        ${{modelVariable}} = {{class}}::factory()->create();

        $response = $this->getJson("{$this->baseUrl}/{${{modelVariable}}->id}");

        $response->assertStatus(200)
                 ->assertJsonStructure([
                     'data',
                 ])
                 ->assertJson([
                     'data' => [
                         'id' => ${{modelVariable}}->id,
                     ],
                 ]);
    }

    public function test_get_non_existent_{{modelVariable}}_returns_404(): void
    {
        $response = $this->getJson("{$this->baseUrl}/99999");

        $response->assertStatus(404);
    }

    public function test_can_update_{{modelVariable}}(): void
    {
        ${{modelVariable}} = {{class}}::factory()->create();
        $data = [
            // Add your update data here
            // 'name' => 'Updated Name',
        ];

        $response = $this->putJson("{$this->baseUrl}/{${{modelVariable}}->id}", $data);

        $response->assertStatus(200)
                 ->assertJsonStructure([
                     'message',
                     'data',
                 ]);
        // $this->assertDatabaseHas('{{tableName}}', array_merge(['id' => ${{modelVariable}}->id], $data));
    }

    public function test_validation_error_on_update_{{modelVariable}}(): void
    {
        ${{modelVariable}} = {{class}}::factory()->create();
        $data = [
            // Add invalid data here
        ];

        $response = $this->putJson("{$this->baseUrl}/{${{modelVariable}}->id}", $data);

        $response->assertStatus(422);
    }

    public function test_can_delete_{{modelVariable}}(): void
    {
        ${{modelVariable}} = {{class}}::factory()->create();

        $response = $this->deleteJson("{$this->baseUrl}/{${{modelVariable}}->id}");

        $response->assertStatus(204);
        $this->assertDatabaseMissing('{{tableName}}', ['id' => ${{modelVariable}}->id]);
    }

    public function test_delete_non_existent_{{modelVariable}}_returns_404(): void
    {
        $response = $this->deleteJson("{$this->baseUrl}/99999");

        $response->assertStatus(404);
    }
}